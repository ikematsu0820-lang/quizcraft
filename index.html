<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Studio</title>
    <link rel="stylesheet" href="style_common.css?v=95">
    <link rel="stylesheet" href="style_host.css?v=95">
    <link rel="stylesheet" href="style_player.css?v=95">
    <link rel="stylesheet" href="style_viewer.css?v=95">
</head>

<body>

    <div id="toast-container"></div>

    <div id="main-view" class="view landing-view">
        <div class="landing-content">
            <div class="landing-logo-area">
                <div class="landing-logo-emoji">💡</div>
                <h1 class="landing-title">Quiz Studio</h1>
                <p class="landing-subtitle">Cloud Edition</p>
            </div>
            <div class="landing-btn-area">
                <button id="main-player-btn" class="landing-btn btn-player-hero">
                    <span class="btn-icon">🎮</span> クイズに参加する
                </button>
                <button id="main-host-btn" class="landing-btn-secondary">
                    <span class="btn-icon">✏️</span> 主催者（クイズを作る）
                </button>
            </div>
        </div>
    </div>

    <div id="host-login-view" class="view landing-view hidden">
        <div class="view-header" style="border:none; margin-bottom:0; justify-content:flex-end;">
            <button class="header-back-btn back-to-main" data-text="Login.BackBtn">ホームに戻る</button>
        </div>
        <div class="landing-content">
            <div class="landing-logo-area">
                <div class="landing-logo-emoji">🔐</div>
                <h1 class="landing-title">Host Login</h1>
                <p class="landing-subtitle">番組IDを入力してください</p>
            </div>
            <div class="login-form-area" style="margin: 0 auto;">
                <input type="text" id="show-id-input" class="modern-input" placeholder="SHOW ID">
                <button id="host-login-submit-btn" class="landing-btn btn-host-modern">ログイン / 新規作成</button>
            </div>
        </div>
    </div>

    <div id="host-dashboard-view" class="view hidden">
        <div class="view-header">
            <h3>Show: <span id="dashboard-show-id" class="accent-text">---</span></h3>
            <button class="header-back-btn btn-logout back-to-main" data-text="Dashboard.Logout">Logout</button>
        </div>



        <div class="dashboard-hero-area dashboard-hero-grid">
            <button id="dash-create-btn" class="dash-btn dash-btn-hero" data-text="Dashboard.BtnCreate">問題作成</button>
            <button id="dash-studio-btn" class="dash-btn dash-btn-hero dash-btn-studio-gold">スタジオ起動</button>
        </div>

        <div class="dashboard-grid-secondary">
            <button id="dash-config-btn" class="dash-btn" data-text="Dashboard.BtnConfig">ルール設定</button>
            <button id="dash-question-design-btn" class="dash-btn">セットデザイン</button>
            <button id="dash-prog-config-btn" class="dash-btn" data-text="Dashboard.BtnProgConfig">プログラム設定</button>
            <button id="dash-production-design-btn" class="dash-btn">シーンデザイン</button>
            <!-- Sound merge planned later, hidden for now -->
            <button id="dash-sound-btn" class="dash-btn hidden" data-text="Dashboard.BtnSound">サウンド</button>
        </div>

        <div class="dashboard-footer-area">
            <button id="dash-viewer-btn" class="dash-btn dash-btn-footer" data-text="Dashboard.BtnViewer">モニター</button>
        </div>
        <div class="dashboard-list-area">
            <h4 class="section-title" data-text="Dashboard.SetListTitle">Saved Sets</h4>
            <div id="dash-set-list" class="scroll-list"></div>
        </div>
    </div>

    <div id="design-view" class="view wide-view hidden">
        <div class="view-header">
            <h2>セットデザイン</h2>
            <button id="design-back-btn" class="header-back-btn">ダッシュボード</button>
        </div>
        <div class="mb-20">
            <div class="mb-15">
                <label class="config-label-large">編集対象を選択</label>
                <div class="flex-row gap-10">
                    <select id="design-target-select" class="btn-block config-select flex-1">
                        <option value="">-- 編集対象を選択 --</option>
                    </select>
                    <button id="design-target-load-btn" class="btn-primary hidden" style="width:100px;">Load</button>
                </div>
            </div>
            <!-- Hidden refresh button for compatibility if needed, or we can just auto-refresh -->
            <button id="design-target-refresh-btn" class="hidden"></button>
        </div>
        <div class="pager-segmented-wrapper">
            <div class="preview-segmented-control design-preview-device-selector" id="design-device-selector"
                style="margin-bottom: 10px;">
                <button id="design-toggle-player" class="segmented-btn active" data-type="player"
                    onclick="App.Design.switchDevice('player')">📱 スマホ</button>
                <button id="design-toggle-monitor" class="segmented-btn" data-type="monitor"
                    onclick="App.Design.switchDevice('monitor')">🖥️ モニター</button>
            </div>
            <div id="design-pager-container" class="design-pager-area hidden">
                <button id="design-pager-prev" class="pager-arrow-btn">◀︎</button>
                <div id="design-pager-status" class="pager-status-text">待機</div>
                <button id="design-pager-next" class="pager-arrow-btn">▶︎</button>
                <!-- Slide Visibility Toggle -->
                <button id="design-pager-hide-toggle" class="pager-hide-btn" title="このスライドを本番で表示しない">
                    <span class="icon-show">👁️</span>
                    <span class="icon-hide">🙈</span>
                </button>

                <!-- Layout Dropdown (Monitor Only) -->
                <div class="design-layout-selector-wrapper" style="margin-left: 15px; display: none;">
                    <select id="creator-set-layout-inline" class="config-select"
                        style="padding: 5px 10px; border-radius: 4px; background: rgba(0, 150, 255, 0.2); border: 1px solid rgba(0, 229, 255, 0.5); color: #fff;">
                        <option value="standard">上下分割 (標準)</option>
                        <option value="split">左右分割</option>
                    </select>
                    <button id="btn-open-grid-config" class="btn-tool-mini hidden" title="選択肢の配置設定"
                        style="margin-left: 10px; padding: 5px 10px; background: rgba(255, 215, 0, 0.2); border: 1px solid rgba(255, 215, 0, 0.5); color: #fff; border-radius: 4px; cursor: pointer;">
                        ▦ 配置
                    </button>
                </div>
            </div>
        </div>

        <div class="design-preview-area-top">
            <!-- Smartphone (Player) -->
            <div id="preview-player-container" class="preview-group player-group">
                <div class="design-preview-frame player-frame">
                    <div id="design-player-preview-content">
                        <div class="player-preview-mock">
                            <div class="p-status-bar"></div>
                            <div class="p-q-text"></div>
                            <div class="p-answers"></div>
                        </div>
                    </div>
                </div>
                <div class="preview-label">回答者画面デモ</div>
            </div>

            <!-- Monitor (Host) -->
            <div id="preview-monitor-container" class="preview-group monitor-group hidden">
                <div class="design-preview-frame">
                    <div id="design-monitor-preview-content"></div>
                </div>
                <div class="preview-label">モニター画面デモ</div>
            </div>
        </div>
        <p class="preview-note">※実際の表示とは解像度が異なります</p>

        <div id="modal-design-layout" class="design-modal-overlay hidden">
            <div class="design-modal-content">
                <h3 class="modal-title">モニターレイアウト</h3>
                <div class="design-modal-body">
                    <label class="config-label">レイアウトを選択</label>
                    <select id="creator-set-layout" class="btn-block">
                        <option value="standard">上下分割 (標準)</option>
                        <option value="split">左右分割</option>
                    </select>
                </div>
                <div class="modal-close-action">
                    <button class="btn-block btn-dark modal-close-btn">閉じる</button>
                </div>
            </div>
        </div>

        <div id="modal-design-text" class="design-modal-overlay hidden">
            <div class="design-modal-content">
                <h3 class="modal-title">テキスト設定</h3>
                <div class="design-modal-body">
                    <div class="config-group">
                        <label class="config-label">文字の配置</label>
                        <div class="align-btn-group">
                            <button type="button" class="btn-align" data-align="left">左揃え</button>
                            <button type="button" class="btn-align active" data-align="center">中央</button>
                            <button type="button" class="btn-align" data-align="right">右揃え</button>
                        </div>
                        <input type="hidden" id="creator-set-align" value="center">
                    </div>

                    <div class="color-row">
                        <label>問題文の文字色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-q-text" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-q-text-transparent" style="margin-right:3px;">
                                色なし</label>
                        </div>
                    </div>
                    <div class="config-group">
                        <label class="config-label">問題文の文字サイズ</label>
                        <input type="text" id="design-q-size" class="btn-block" placeholder="48px">
                    </div>
                    <div class="color-row mt-10">
                        <label>選択肢の文字色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-c-text" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-c-text-transparent" style="margin-right:3px;">
                                色なし</label>
                        </div>
                    </div>
                    <div class="config-group">
                        <label class="config-label">選択肢の文字サイズ</label>
                        <input type="text" id="design-c-size" class="btn-block" placeholder="32px">
                    </div>
                </div>
                <div class="modal-close-action">
                    <button class="btn-block btn-dark modal-close-btn">閉じる</button>
                </div>
            </div>
        </div>
        <div id="modal-design-object" class="design-modal-overlay hidden">
            <div class="design-modal-content">
                <h3 class="modal-title">オブジェクト設定</h3>
                <div class="design-modal-body">
                    <h4 class="sub-title">問題文エリア</h4>
                    <div class="color-row">
                        <label>枠線の色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-q-border" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-q-border-transparent" style="margin-right:3px;">
                                色なし</label>
                        </div>
                    </div>
                    <div class="color-row">
                        <label>背景の色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-q-bg" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-q-bg-transparent" style="margin-right:3px;"> 色なし</label>
                        </div>
                    </div>

                    <h4 class="sub-title">選択肢エリア</h4>
                    <div class="color-row">
                        <label>枠線の色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-c-border" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-c-border-transparent" style="margin-right:3px;">
                                色なし</label>
                        </div>
                    </div>
                    <div class="color-row">
                        <label>背景の色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-c-bg" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-c-bg-transparent" style="margin-right:3px;"> 色なし</label>
                        </div>
                    </div>
                </div>
                <div class="modal-close-action">
                    <button class="btn-block btn-dark modal-close-btn">閉じる</button>
                </div>
            </div>
        </div>

        <!-- Grid Config Modal -->
        <div id="modal-design-grid" class="design-modal-overlay hidden">
            <div class="design-modal-content" style="max-width:350px;">
                <h3 class="modal-title">選択肢の配置設定</h3>
                <div class="design-modal-body">
                    <p style="color:#aaa; font-size:0.9em; margin-bottom:15px; text-align:center;">グリッドの行数・列数を設定</p>
                    <div style="display:flex; gap:15px; margin-bottom:20px;">
                        <div style="flex:1;">
                            <label class="config-label" style="text-align:center; display:block;">行数 (Rows)</label>
                            <input type="number" id="design-grid-rows" class="form-control" value="4" min="1" max="10"
                                style="text-align:center; width:100%; padding:10px; border-radius:8px; border:none; background:#333; color:#fff; box-sizing:border-box;">
                        </div>
                        <div style="flex:1;">
                            <label class="config-label" style="text-align:center; display:block;">列数 (Cols)</label>
                            <input type="number" id="design-grid-cols" class="form-control" value="1" min="1" max="10"
                                style="text-align:center; width:100%; padding:10px; border-radius:8px; border:none; background:#333; color:#fff; box-sizing:border-box;">
                        </div>
                    </div>
                </div>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="btn-block modal-close-btn" style="background:#555; color:#ccc;">キャンセル</button>
                    <button class="btn-block" id="btn-apply-grid-config"
                        style="background:var(--color-primary); color:#000; font-weight:bold;">決定</button>
                </div>
            </div>
        </div>

        <div id="modal-design-bg" class="design-modal-overlay hidden">
            <!-- Existing content -->
            <div class="design-modal-content">
                <h3 class="modal-title">背景設定</h3>
                <div class="design-modal-body">
                    <div class="color-row">
                        <label>全体背景色</label>
                        <div class="color-picker-wrapper" style="display:flex; align-items:center; gap:5px;">
                            <input type="color" id="design-main-bg-color" class="color-picker-full" style="flex:1;">
                            <label style="font-size:12px; white-space:nowrap; display:flex; align-items:center;"><input
                                    type="checkbox" id="design-main-bg-color-transparent" style="margin-right:3px;">
                                色なし</label>
                        </div>
                    </div>

                    <label class="config-label mt-20">背景画像</label>
                    <div class="image-upload-area">
                        <input type="file" id="design-bg-image-file" accept="image/*" style="display:none;">
                        <button id="design-bg-image-btn" class="btn-primary btn-block mb-10">画像ファイルを選択</button>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span id="design-bg-image-status" class="status-text">未選択</span>
                            <button id="design-bg-clear-btn" class="btn-danger btn-mini">解除</button>
                        </div>
                    </div>
                    <input type="hidden" id="design-bg-image-data">
                </div>
                <div class="modal-close-action">
                    <button class="btn-block btn-dark modal-close-btn">閉じる</button>
                </div>
            </div>
        </div>

    </div>
    </div>

    <!-- Shared Quick Inspector (Used by Design Studio & Scene Design) -->
    <div id="modal-design-quick" class="quick-inspector-overlay hidden">
        <div class="quick-inspector-content">
            <div class="quick-modal-header">
                <h3 id="quick-modal-title" class="modal-title">編集</h3>
            </div>
            <div id="quick-modal-body" class="design-modal-body">
                <!-- JSで動的に構築 -->
            </div>
            <div class="modal-close-action">
                <button class="btn-block btn-primary modal-close-btn toolbar-done-btn"
                    onclick="App.Design.closeQuickEdit()">完了</button>
            </div>
        </div>
    </div>

    <div id="production-design-view" class="view wide-view hidden">
        <div class="view-header">
            <h2>シーンデザイン</h2>
            <button class="header-back-btn">ダッシュボード</button>
        </div>
        <div class="design-toolbar-toggle-area">
            <button id="btn-toggle-prod-design-toolbar" class="btn-mini btn-dark">📂 ロード解除 / 切り替え</button>
        </div>
        <div id="prod-design-toolbar-container">
            <div class="design-toolbar">
                <div class="toolbar-select">
                    <select id="prod-design-target-select" class="btn-block">
                        <option value="">-- 編集対象を選択 --</option>
                    </select>
                </div>
                <button id="prod-design-target-load-btn" class="btn-primary toolbar-btn">Load</button>
            </div>
        </div>

        <div class="design-preview-area-top">
            <h4 class="preview-label">プレビュー</h4>
            <div class="pager-segmented-wrapper">
                <div class="preview-segmented-control prod-preview-type-selector">
                    <button class="segmented-btn active" data-type="title" title="タイトル">🎬</button>
                    <button class="segmented-btn" data-type="qnumber" title="問題番号">🔢</button>
                    <button class="segmented-btn" data-type="ranking" title="ランキング">🏆</button>
                </div>
                <div class="preview-segmented-control prod-preview-device-selector">
                    <button class="segmented-btn active" data-device="player" title="参加者スマホ">📱 スマホ</button>
                    <button class="segmented-btn" data-device="monitor" title="モニター画面">🖥️ モニター</button>
                </div>
            </div>

            <div id="preview-player-container-prod" class="design-preview-frame player-frame">
                <div id="prod-player-preview-content">
                    <div class="player-preview-mock">
                        <div class="p-status-bar"></div>
                        <div id="prod-player-mock-body" class="p-q-text"
                            style="display:flex; align-items:center; justify-content:center; height:100%; font-size:1.2em; font-weight:800;">
                            タイトルプレビュー</div>
                        <div class="p-answers"></div>
                    </div>
                </div>
            </div>
            <div id="preview-monitor-container-prod" class="design-preview-frame hidden">
                <div id="prod-design-preview-content"></div>
            </div>
            <p class="preview-note">※実際の表示とは解像度が異なります</p>
        </div>

        <!-- Compact menu removed as it was redundant with segmented control -->

    </div>

    <div id="creator-view" class="view hidden">
        <div class="view-header">
            <h2 data-text="Creator.Title">Creator</h2>
            <button id="creator-back-btn" class="header-back-btn">ダッシュボード</button>
        </div>
        <div class="panel-section section-blue mb-20">
            <div class="creator-row">
                <label class="config-label" data-text="Creator.LabelTypeFixed">Fixed Type</label>
                <select id="creator-q-type" class="btn-block bold-select"></select>
            </div>
            <div id="creator-q-subtype-area" class="mt-10 hidden">
                <div class="creator-row">
                    <label class="config-label">回答形式を選択</label>
                    <select id="creator-q-subtype" class="btn-block bold-select"></select>
                </div>
            </div>
            <p id="creator-type-locked-msg" class="locked-msg hidden" data-text="Creator.MsgTypeLocked">Locked</p>
        </div>
        <div class="panel-section section-pink mb-20">
            <h3 id="creator-form-title" class="panel-title-large" data-text="Creator.HeadingNewQ">New Question</h3>
            <div class="mb-10">
                <label class="config-label q-label-prominent">問題文</label>
                <input type="text" id="question-text" class="btn-block mb-0" placeholder="問題を入力してください">
            </div>
            <div id="creator-form-container" class="mb-10"></div>

            <div class="panel-section section-gray mb-10">
                <div class="creator-row" style="align-items: flex-start;">
                    <label class="config-label" style="padding-top: 8px;">解説設定</label>
                    <textarea id="creator-commentary" class="btn-block" placeholder="解説を入力して下さい" rows="2"
                        style="flex:1; margin-bottom:0;"></textarea>
                </div>
            </div>
            <button id="add-question-btn" class="btn-primary btn-block mt-10" data-text="Creator.BtnAdd">Add</button>
            <div id="update-question-area" class="hidden grid-2-col gap-10 mt-10">
                <button id="update-question-btn" class="btn-success" data-text="Creator.BtnUpdateQ">Update</button>
                <button id="cancel-update-btn" class="btn-dark" data-text="Creator.BtnCancel">Cancel</button>
            </div>
        </div>
        <div class="creator-set-settings">
            <h5 data-text="Creator.ListHeading" class="mb-5">List</h5>
            <div id="q-list" class="scroll-list mb-15"></div>
        </div>

    </div>

    <div id="config-view" class="view hidden">
        <div class="view-header">
            <h2 data-text="Config.Title">Rule Settings</h2>
            <button id="config-header-back-btn" class="header-back-btn">ダッシュボード</button>
        </div>
        <div class="mb-20">
            <div class="mb-15">
                <label class="config-label-large" data-text="Config.LabelSet">対象セットを選択</label>
                <select id="config-set-select" class="btn-block config-select"></select>
            </div>
            <div id="config-builder-ui"></div>
        </div>
    </div>

    <div id="prog-config-view" class="view hidden">
        <div class="view-header">
            <h2 data-text="Dashboard.BtnProgConfig">Program Settings</h2>
            <button id="prog-config-back-btn" class="header-back-btn">ダッシュボード</button>
        </div>

        <div class="panel-section section-purple mb-20">
            <h3 class="panel-title-center">番組の構成 (セットの再生順)</h3>
            <p class="text-sm text-gray mb-15">保存済みのセット（ルール適用済み）を選択して追加してください。</p>
            <div class="flex-row gap-10">
                <select id="prog-set-select" class="btn-block config-select flex-1"></select>
                <button id="prog-add-set-btn" class="btn-primary" style="width:100px;">追加</button>
            </div>
        </div>

        <div class="config-playlist-area">
            <h4 class="section-title">番組セットリスト</h4>
            <div id="prog-playlist-preview" class="scroll-list-dark">
                <p class="empty-msg">まだ追加されていません</p>
            </div>

            <button id="prog-open-load-modal-btn" class="btn-dark btn-block mt-10">📂 保存済み番組を読み込む</button>
        </div>


        <!-- Load Modal -->
        <div id="prog-load-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 class="modal-title">プログラムの読み込み</h3>
                <select id="prog-load-select" class="btn-block config-select mb-20">
                    <option value="">読み込み中...</option>
                </select>
                <div class="grid-2-col gap-10">
                    <button id="prog-load-exec-btn" class="btn-primary">読み込む</button>
                    <button id="prog-load-close-btn" class="btn-dark">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <div id="host-control-view" class="view hidden host-studio-layout">
        <div class="studio-header-bar">
            <div class="status-item">
                <span class="status-label">部屋ID</span>
                <span id="studio-header-room-id" class="status-value text-yellow" title="クリックしてコピー">---</span>
            </div>
            <div class="status-item"><span class="status-label">問題数</span><span id="studio-q-num-display"
                    class="status-value">1/10</span></div>
            <div class="status-item">
                <span class="status-label">参加人数</span>
                <span id="studio-player-count-display" class="status-value">0</span>
            </div>
            <div class="status-item" style="flex: 1; max-width: 300px;">
                <span class="status-label">参加者</span>
                <div id="studio-player-list-display" class="player-list-compact">
                    <span style="color:#666; font-size:0.8em;">待機中...</span>
                </div>
            </div>

            <div id="studio-solo-info" class="status-item hidden">
                <span class="status-label">挑戦者</span><span id="studio-challenger-name"
                    class="status-value text-pink">---</span>
                <span class="status-label ml-10">ライフ</span><span id="studio-life-display" class="status-value">3</span>
            </div>
            <button id="host-close-studio-btn" class="header-back-btn" style="margin-left: auto;">ダッシュボード</button>
        </div>

        <div class="studio-main-area">
            <div id="studio-standby-panel" class="center-message">
                <div class="big-room-id-box">
                    <span class="label">部屋ID (クリックしてコピー)</span>
                    <span id="studio-big-room-id" title="クリックしてコピー">------</span>
                </div>

                <div id="studio-program-info" class="text-gray mb-20"></div>

                <div id="studio-loader-ui" class="panel-section section-blue" style="max-width:400px; margin:0 auto;">
                    <select id="studio-program-select" class="btn-block config-select mb-10"></select>
                    <button id="studio-load-program-btn" class="btn-primary btn-block"
                        data-text="Studio.BtnLoad">Set</button>
                </div>
                <div id="studio-period-timeline" class="timeline-container mt-20"></div>
            </div> <!-- closes studio-standby-panel -->

            <div id="studio-execution-grid" class="studio-execution-grid hidden">
                <!-- Tab Switcher (Mobile Only) - Optional now, but keeping for flexibility -->
                <div class="studio-tab-switcher">
                    <div class="preview-segmented-control">
                        <button class="segmented-btn active" data-tab="monitors">📺 プレビュー</button>
                        <button class="segmented-btn" data-tab="controls">🎛️ コンソール</button>
                    </div>
                </div>

                <div class="studio-monitors-row">
                    <div class="studio-monitor-item current">
                        <div class="current-screen-label">📸 今の画面</div>
                        <div id="studio-monitor-frame" class="studio-monitor-frame">
                            <div id="studio-question-panel" class="question-monitor">
                                <div class="monitor-header">
                                    <span id="studio-q-type-badge" class="badge-type">CHOICE</span>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <span id="studio-timer-display" class="monitor-timer hidden">TIME: 10</span>
                                        <span id="studio-player-sync-status" class="badge-type"
                                            style="background:rgba(0,229,255,0.1); color:var(--color-primary);">READY</span>
                                    </div>
                                </div>
                                <div id="studio-q-text" class="monitor-q-text"></div>
                                <div id="studio-choices-container" class="monitor-choices"></div>
                                <div id="studio-correct-display" class="monitor-correct hidden">
                                    <div class="label" style="font-size:0.6em; margin-bottom:5px; opacity:0.7;">CORRECT
                                        ANSWER
                                    </div>
                                    <div id="studio-correct-text"></div>
                                    <div id="studio-commentary-text"
                                        style="font-size:0.5em; font-weight:normal; margin-top:10px; color:#aaa; line-height:1.4;">
                                    </div>
                                </div>
                                <div id="studio-sub-info" class="monitor-sub-info hidden"></div>
                            </div>
                        </div>
                    </div>

                    <div class="studio-monitor-item next">
                        <div class="sidebar-section-label">📺 次の画面</div>
                        <div id="studio-next-frame" class="studio-monitor-frame">
                            <div id="studio-next-preview-panel" class="question-monitor">
                                <div id="studio-next-monitor-content"
                                    style="width:100%; height:100%; display:flex; flex-direction:column; justify-content:center;">
                                    <div class="preview-placeholder">待機中...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Unified Console Layout (PC & Mobile) -->
                <div class="studio-console-layout">
                    <div class="console-main-row">
                        <div class="console-selected-answer-area">
                            <div class="console-selected-answer-box">
                                <div id="console-selected-player-name" class="selected-name-label">選択中の回答者</div>
                                <div id="console-selected-player-answer" class="selected-answer-text">回答待ち...</div>
                            </div>
                        </div>
                        <div class="console-control-column">
                            <div class="control-label">判定</div>
                            <div class="console-judge-grid">
                                <button id="console-btn-judge-correct" class="btn-judge btn-success">⭕</button>
                                <button id="console-btn-judge-wrong" class="btn-judge btn-danger">❌</button>
                            </div>
                            <!-- Primary action button synced from studio-footer-controls -->
                            <button id="console-btn-phase-main" class="btn-large-action">Q.1 開始</button>
                        </div>
                    </div>

                    <div class="console-player-list-area">
                        <div class="sidebar-section-label">👥 回答者一覧 (早い順)</div>
                        <div id="console-player-horizontal-list" class="console-horizontal-scroll">
                            <!-- JSで生成 -->
                        </div>
                    </div>
                </div>

                <div class="studio-answers-row hidden">
                    <div class="studio-grid-right-answers">
                        <div class="sidebar-section-label">👥 回答者の回答</div>
                        <div id="studio-answer-stats" class="studio-answer-stats-bar">
                            <div id="studio-answered-count" class="stats-value">0 / 0</div>
                            <div class="stats-progress-container">
                                <div id="studio-answer-progress" class="stats-progress-bar"></div>
                            </div>
                        </div>
                        <div id="studio-player-answers" class="studio-realtime-answers"></div>
                    </div>
                </div>
            </div>
        </div> <!-- closes studio-main-area -->

        <div class="studio-footer-controls">
            <button id="btn-phase-main" class="btn-block btn-large-action hidden">START</button>
            <div id="studio-sub-controls" class="sub-controls-grid hidden">
                <button id="btn-judge-correct" class="btn-success btn-judge">⭕ 正解</button>
                <button id="btn-judge-wrong" class="btn-danger btn-judge">❌ 不正解</button>
            </div>
            <div class="footer-tools">
                <button id="btn-toggle-ans" class="btn-mini btn-dark">正解表示</button>
                <button id="btn-force-next" class="btn-mini btn-dark">強制スキップ</button>
            </div>
        </div>

        <!-- Panel Selection Modal -->
        <div id="panel-selection-modal" class="design-modal-overlay hidden">
            <div class="design-modal-content" style="max-width: 600px;">
                <h3 class="modal-title">パネル選択</h3>
                <div class="design-modal-body">
                    <div id="panel-winner-info"
                        style="text-align:center; margin-bottom:20px; font-size:1.2em; color:#0f0;">
                        <span id="panel-winner-name"></span> が正解！
                    </div>
                    <div style="margin-bottom:15px; text-align:center;">
                        <label style="color:#aaa; margin-right:10px;">選択する色:</label>
                        <div id="panel-color-selector"
                            style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                        </div>
                    </div>
                    <div id="panel-selection-grid" class="panel-grid-5x5">
                    </div>
                </div>
                <div class="modal-close-action">
                    <button id="panel-selection-close" class="btn-block btn-dark">完了</button>
                </div>
            </div>
        </div>
    </div>

    <div id="ranking-view" class="view hidden center-text">
        <h2 class="ranking-title-main">RANKING</h2>
        <div id="ranking-list" class="ranking-container"></div>
        <button id="ranking-back-btn" class="btn-primary btn-block mt-20"
            data-text="Studio.BtnBackRanking">Back</button>
    </div>

    <div id="respondent-view" class="view landing-view hidden">
        <div class="view-header" style="border:none; margin-bottom:0; justify-content:flex-end;">
            <button class="header-back-btn back-to-main" data-text="Login.BackBtn">ホームに戻る</button>
        </div>
        <div class="landing-content">
            <div class="landing-logo-area">
                <div class="landing-logo-emoji">🎮</div>
                <h1 class="landing-title">Entry</h1>
                <p class="landing-subtitle">参加情報を入力してください</p>
            </div>
            <div class="login-form-area" style="margin: 0 auto;">
                <input type="text" id="room-code-input" class="modern-input" placeholder="部屋コード (6桁)" maxlength="6">
                <input type="text" id="player-name-input" class="modern-input" placeholder="ニックネーム">
                <button id="join-room-btn" class="landing-btn btn-player-modern">参加する</button>
            </div>
        </div>
    </div>

    <div id="player-game-view" class="view hidden">
        <div id="player-status-bar" class="player-status-bar">
            <span id="player-name-disp" class="player-name">---</span>
            <span id="alive-badge" class="alive-badge" data-text="Player.BadgeAlive">ALIVE</span>
        </div>
        <div id="score-display-area" class="hidden score-area">Score: <span id="current-score-value">0</span></div>
        <div id="player-lobby-msg" class="lobby-msg"></div>
        <div id="player-buzz-area" class="hidden center-text mt-20">
            <button id="player-buzz-btn" class="buzz-btn" data-text="Player.BtnBuzz">PUSH!</button>
        </div>
        <div id="player-quiz-area" class="hidden">
            <div id="question-text-disp" class="player-q-text"></div>
            <div id="player-input-container"></div>
            <div id="answer-timer-disp" class="timer-disp"></div>
        </div>
        <div id="player-oral-done-area" class="hidden center-text mt-20">
            <button id="player-oral-done-btn" class="btn-primary btn-block btn-large"
                data-text="Player.BtnAnswered">Answered</button>
        </div>
        <div id="player-wait-msg" class="hidden wait-msg" data-text="Player.MsgAnswered">Answered...</div>
        <div id="player-result-overlay" class="hidden overlay-result">
            <div id="result-icon"></div>
            <div id="result-text"></div>
            <div id="result-detail"></div>
        </div>
        <div id="player-ranking-overlay" class="hidden overlay-ranking">
            <h2 class="rank-title" data-text="Player.RankTitle">RANKING</h2>
            <div data-text="Player.RankYou">You are...</div>
            <div id="player-my-rank" class="my-rank">---</div>
            <div id="player-my-score" class="my-score">---</div>
            <div class="leaderboard-box">
                <div class="lb-title" data-text="Player.RankBoardTitle">Top Leaders</div>
                <div id="player-leaderboard" class="lb-list"></div>
            </div>
        </div>
        <div id="player-dead-overlay" class="hidden overlay-dead">
            <h1 class="dead-title" data-text="Player.MsgDead">GAME OVER</h1>
            <p data-text="Player.MsgDeadBody">Dead...</p>
        </div>
    </div>

    <div id="viewer-login-view" class="view landing-view hidden">
        <div class="view-header" style="border:none; margin-bottom:0; justify-content:flex-end;">
            <button class="header-back-btn back-to-main">ダッシュボード</button>
        </div>
        <div class="landing-content">
            <div class="landing-logo-area">
                <div class="landing-logo-emoji">🖥</div>
                <h1 class="landing-title">Monitor</h1>
                <p class="landing-subtitle">モニター用接続</p>
            </div>
            <div class="login-form-area" style="margin: 0 auto;">
                <input type="text" id="viewer-room-code" class="modern-input" placeholder="部屋コード (6桁)">
                <button id="viewer-connect-btn" class="landing-btn btn-player-modern">接続する</button>
            </div>
        </div>
    </div>

    <div id="viewer-main-view" class="view hidden">
        <div id="viewer-content">
            <div id="viewer-status"></div>
            <div id="viewer-main-text"></div>
            <div id="viewer-panel-grid" class="hidden"></div>
            <div id="viewer-bomb-grid" class="hidden"></div>
            <div id="viewer-multi-grid" class="hidden"></div>
            <div id="viewer-sub-text"></div>
            <div id="viewer-ranking-area"></div>
            <div id="viewer-race-area" class="hidden"></div>
            <div id="viewer-timer-bar-area" class="hidden">
                <div id="viewer-timer-bar"></div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Drag & Drop Library -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="firebase.js"></script>
    <script src="text_config.js?v=95"></script>
    <script src="host_core.js?v=95"></script>
    <script src="host_design.js?v=95"></script>
    <script src="host_production_design.js?v=95"></script>
    <script src="host_creator.js?v=95"></script>
    <script src="host_config.js?v=95"></script>
    <script src="host_prog_config.js?v=95"></script>
    <script src="host_studio.js?v=95"></script>
    <script src="player.js?v=95"></script>
    <script src="viewer.js?v=95"></script>


    <!-- Edit Menu Modal -->
    <div id="edit-menu-modal" class="design-modal-overlay hidden">
        <div class="design-modal-content" style="max-width: 500px;">
            <h3 class="modal-title">編集メニュー</h3>
            <div id="edit-menu-set-title" style="text-align:center; color:#0ff; margin-bottom:20px; font-size:1.1em;">
            </div>
            <div class="design-modal-body">
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <button id="edit-menu-questions" class="btn-block btn-primary"
                        style="padding:15px; font-size:1.1em;">
                        📝 問題作成
                    </button>
                    <button id="edit-menu-rules" class="btn-block btn-info" style="padding:15px; font-size:1.1em;">
                        ⚙️ ルール設定
                    </button>
                    <button id="edit-menu-design" class="btn-block btn-success" style="padding:15px; font-size:1.1em;">
                        🎨 問題デザイン
                    </button>

                </div>
            </div>
            <div class="modal-close-action">
                <button id="edit-menu-close" class="btn-block btn-dark">閉じる</button>
            </div>
        </div>
    </div>
</body>
<!-- Global FAB Save Actions -->
<div class="fab-save-container">
    <!-- Creator Save -->
    <button id="fab-creator-save" class="fab-btn fab-only-visible" title="セットを保存">
        <span class="fab-icon">💾</span>
        <span class="fab-label">SAVE</span>
    </button>
    <!-- Rule Config Save -->
    <button id="fab-config-save" class="fab-btn fab-only-visible" title="ルールを保存">
        <span class="fab-icon">⚙️</span>
        <span class="fab-label">RULES</span>
    </button>
    <!-- Set Design Save -->
    <button id="fab-design-save" class="fab-btn fab-only-visible" title="デザインを保存">
        <span class="fab-icon">🎨</span>
        <span class="fab-label">DESIGN</span>
    </button>
    <!-- Production Design Save -->
    <button id="fab-prod-save" class="fab-btn fab-only-visible" title="演出設定を保存">
        <span class="fab-icon">🎬</span>
        <span class="fab-label">SCENE</span>
    </button>
    <!-- Program Config Save -->
    <button id="fab-prog-save" class="fab-btn fab-only-visible" title="番組構成を保存">
        <span class="fab-icon">📺</span>
        <span class="fab-label">PLAN</span>
    </button>
</div>
</body>

</html>
<div id="modal-prod-title" class="design-modal-overlay hidden">
    <div class="design-modal-content">
        <h3 class="modal-title">タイトル画面設定</h3>
        <div class="design-modal-body">
            <div class="config-group">
                <label class="config-label">表示するタイトル名</label>
                <input type="text" id="design-title-text-value" class="btn-block" placeholder="例: プレビュー用タイトル">
                <p class="text-xs text-gray mt-5">※デザイン確認用の入力です（保存はされません）</p>
            </div>
            <div class="color-row">
                <label>背景色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-title-bg-color" class="color-picker-full" value="#000000">
                    <label class="text-xs ml-5" style="display:inline-flex; align-items:center;"><input type="checkbox"
                            id="prod-title-bg-color-transparent" style="margin-right:3px;"> 色なし</label>
                </div>
            </div>
            <div class="color-row">
                <label>文字色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-title-text-color" class="color-picker-full" value="#ffd700">
                    <label class="text-xs ml-5" style="display:inline-flex; align-items:center;"><input type="checkbox"
                            id="prod-title-text-color-transparent" style="margin-right:3px;"> 色なし</label>
                </div>
            </div>
            <div class="config-group">
                <label class="config-label">フォント</label>
                <select id="prod-title-font" class="btn-block">
                    <option value="sans-serif">Sans-serif (標準)</option>
                    <option value="serif">Serif (明朝)</option>
                    <option value="monospace">Monospace (等幅)</option>
                </select>
            </div>
            <div class="config-group">
                <label class="config-label">文字サイズ</label>
                <input type="text" id="prod-title-size" class="btn-block" value="" placeholder="120px">
            </div>
            <div class="config-group">
                <label class="config-label">アニメーション</label>
                <select id="prod-title-animation" class="btn-block">
                    <option value="fade">フェード</option>
                    <option value="slide">スライド</option>
                    <option value="pop">ポップ</option>
                </select>
            </div>
        </div>
        <div class="modal-close-action">
            <button class="btn-block btn-dark modal-close-btn">閉じる</button>
        </div>
    </div>
</div>

<div id="modal-prod-qnum" class="design-modal-overlay hidden">
    <div class="design-modal-content">
        <h3 class="modal-title">問題番号設定</h3>
        <div class="design-modal-body">
            <div class="config-group">
                <label class="config-label">表示するテキスト</label>
                <input type="text" id="design-qnum-text-value" class="btn-block" placeholder="例: 第1問">
            </div>
            <div class="color-row">
                <label>背景色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-qnum-bg-color" class="color-picker-full" value="#000000">
                    <label class="text-xs ml-5" style="display:inline-flex; align-items:center;"><input type="checkbox"
                            id="prod-qnum-bg-color-transparent" style="margin-right:3px;"> 色なし</label>
                </div>
            </div>
            <div class="color-row">
                <label>文字色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-qnum-text-color" class="color-picker-full" value="#ffffff">
                    <label class="text-xs ml-5" style="display:inline-flex; align-items:center;"><input type="checkbox"
                            id="prod-qnum-text-color-transparent" style="margin-right:3px;"> 色なし</label>
                </div>
            </div>
            <div class="config-group">
                <label class="config-label">フォント</label>
                <select id="prod-qnum-font" class="btn-block">
                    <option value="sans-serif">Sans-serif (標準)</option>
                    <option value="serif">Serif (明朝)</option>
                    <option value="monospace">Monospace (等幅)</option>
                </select>
            </div>
            <div class="config-group">
                <label class="config-label">文字サイズ</label>
                <input type="text" id="prod-qnum-size" class="btn-block" placeholder="10vh">
            </div>
            <div class="config-group">
                <label class="config-label">表示位置</label>
                <select id="prod-qnum-position" class="btn-block">
                    <option value="center">中央</option>
                    <option value="top">上部</option>
                    <option value="bottom">下部</option>
                </select>
            </div>
            <div class="config-group">
                <label class="config-label">アニメーション</label>
                <select id="prod-qnum-animation" class="btn-block">
                    <option value="fade">フェード</option>
                    <option value="slide">スライド</option>
                    <option value="pop">ポップ</option>
                </select>
            </div>
        </div>
        <div class="modal-close-action">
            <button class="btn-block btn-dark modal-close-btn">閉じる</button>
        </div>
    </div>
</div>

<div id="modal-prod-ranking" class="design-modal-overlay hidden">
    <div class="design-modal-content">
        <h3 class="modal-title">ランキング設定</h3>
        <div class="design-modal-body">
            <div class="color-row">
                <label>背景色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-ranking-bg-color" class="color-picker-full" value="#000000">
                </div>
            </div>
            <div class="color-row">
                <label>文字色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-ranking-text-color" class="color-picker-full" value="#ffffff">
                </div>
            </div>
            <div class="color-row">
                <label>アクセント色</label>
                <div class="color-picker-wrapper">
                    <input type="color" id="prod-ranking-accent-color" class="color-picker-full">
                </div>
            </div>
            <div class="config-group">
                <label class="config-label">フォント</label>
                <select id="prod-ranking-font" class="btn-block">
                    <option value="sans-serif">Sans-serif (標準)</option>
                    <option value="serif">Serif (明朝)</option>
                    <option value="monospace">Monospace (等幅)</option>
                </select>
            </div>
            <div class="config-group">
                <label class="config-label">アニメーション</label>
                <select id="prod-ranking-animation" class="btn-block">
                    <option value="fade">フェード</option>
                    <option value="cascade">カスケード</option>
                    <option value="pop">ポップ</option>
                </select>
            </div>
        </div>
        <div class="modal-close-action">
            <button class="btn-block btn-dark modal-close-btn">閉じる</button>
        </div>
    </div>
</div>